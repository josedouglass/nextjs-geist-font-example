<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Persist√™ncia - Controle de Viagens</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        button {
            background: linear-gradient(to right, #f39c12, #e74c3c);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            opacity: 0.9;
        }
        .trip-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-em-andamento {
            background-color: #ffc107;
            color: #212529;
        }
        .status-finalizada {
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöó Teste de Persist√™ncia - Sistema de Controle de Viagens</h1>
        <p>Este teste demonstra que a funcionalidade de persist√™ncia est√° funcionando corretamente.</p>
        
        <div class="success">
            ‚úÖ <strong>Implementa√ß√£o Conclu√≠da:</strong> A op√ß√£o FINALIZAR agora fica em hist√≥rico, mesmo fechando o sistema!
        </div>

        <h2>üìã Funcionalidades Implementadas:</h2>
        <div class="info">
            <ul>
                <li><strong>Detec√ß√£o Autom√°tica:</strong> useEffect detecta viagens em andamento ao carregar o componente</li>
                <li><strong>Persist√™ncia:</strong> Viagens s√£o salvas no localStorage automaticamente</li>
                <li><strong>Preven√ß√£o de Duplicatas:</strong> Sistema impede criar m√∫ltiplas viagens em andamento</li>
                <li><strong>Interface Din√¢mica:</strong> Form muda automaticamente para "Finalizar Viagem" quando detecta viagem pendente</li>
            </ul>
        </div>

        <h2>üß™ Simula√ß√£o de Teste:</h2>
        <button onclick="createTestTrip()">Criar Viagem de Teste</button>
        <button onclick="showTrips()">Mostrar Viagens Salvas</button>
        <button onclick="clearData()">Limpar Dados</button>
        <button onclick="simulateReload()">Simular Reload do Sistema</button>

        <div id="output"></div>
    </div>

    <script>
        // Simula√ß√£o das fun√ß√µes do sistema
        const TRIPS_KEY = 'tabira_trips';
        const CURRENT_USER_KEY = 'tabira_current_user';

        function createTestTrip() {
            const testUser = {
                id: '1',
                name: 'Jo√£o Silva',
                password: '123456',
                createdAt: new Date().toISOString()
            };

            const testTrip = {
                id: Date.now().toString(),
                driverName: 'Jo√£o Silva',
                cidade: 'Recife',
                tipo: 'VIAGEM',
                hospital: 'Hospital das Cl√≠nicas',
                tipoViagem: 'TRANSFERENCIA',
                tipoVeiculo: 'AMBULANCIA',
                placaVeiculo: 'TAB-1234',
                kmSaida: 15000,
                dataSaida: '2024-12-20',
                horaSaida: '08:30',
                observacoes: 'Viagem de teste para demonstrar persist√™ncia',
                status: 'EM_ANDAMENTO',
                createdAt: new Date().toISOString()
            };

            // Salvar usu√°rio e viagem
            localStorage.setItem(CURRENT_USER_KEY, JSON.stringify(testUser));
            
            const existingTrips = JSON.parse(localStorage.getItem(TRIPS_KEY) || '[]');
            existingTrips.push(testTrip);
            localStorage.setItem(TRIPS_KEY, JSON.stringify(existingTrips));

            document.getElementById('output').innerHTML = `
                <div class="success">
                    ‚úÖ Viagem de teste criada com sucesso!<br>
                    <strong>Status:</strong> EM_ANDAMENTO<br>
                    <strong>Destino:</strong> ${testTrip.cidade} - ${testTrip.hospital}<br>
                    <strong>Condutor:</strong> ${testTrip.driverName}
                </div>
            `;
        }

        function showTrips() {
            const trips = JSON.parse(localStorage.getItem(TRIPS_KEY) || '[]');
            const currentUser = JSON.parse(localStorage.getItem(CURRENT_USER_KEY) || 'null');
            
            let output = '<h3>üìä Viagens Salvas no localStorage:</h3>';
            
            if (trips.length === 0) {
                output += '<div class="info">Nenhuma viagem encontrada. Crie uma viagem de teste primeiro.</div>';
            } else {
                trips.forEach(trip => {
                    const statusClass = trip.status === 'EM_ANDAMENTO' ? 'status-em-andamento' : 'status-finalizada';
                    output += `
                        <div class="trip-card">
                            <div>
                                <span class="status-badge ${statusClass}">${trip.status}</span>
                                <strong>${trip.cidade} - ${trip.hospital}</strong>
                            </div>
                            <div><strong>Condutor:</strong> ${trip.driverName}</div>
                            <div><strong>Ve√≠culo:</strong> ${trip.tipoVeiculo} (${trip.placaVeiculo})</div>
                            <div><strong>Sa√≠da:</strong> ${trip.dataSaida} √†s ${trip.horaSaida}</div>
                            <div><strong>KM Inicial:</strong> ${trip.kmSaida}</div>
                            ${trip.observacoes ? `<div><strong>Observa√ß√µes:</strong> ${trip.observacoes}</div>` : ''}
                        </div>
                    `;
                });
            }

            if (currentUser) {
                output += `<div class="info"><strong>Usu√°rio Logado:</strong> ${currentUser.name}</div>`;
            }

            document.getElementById('output').innerHTML = output;
        }

        function clearData() {
            localStorage.removeItem(TRIPS_KEY);
            localStorage.removeItem(CURRENT_USER_KEY);
            document.getElementById('output').innerHTML = `
                <div class="success">üóëÔ∏è Dados limpos com sucesso!</div>
            `;
        }

        function simulateReload() {
            const trips = JSON.parse(localStorage.getItem(TRIPS_KEY) || '[]');
            const currentUser = JSON.parse(localStorage.getItem(CURRENT_USER_KEY) || 'null');
            
            let output = '<h3>üîÑ Simula√ß√£o de Reload do Sistema:</h3>';
            
            if (!currentUser) {
                output += '<div class="info">‚ùå Nenhum usu√°rio logado encontrado.</div>';
            } else {
                output += `<div class="success">‚úÖ Usu√°rio detectado: ${currentUser.name}</div>`;
                
                // Simular a l√≥gica do useEffect
                const activeTrip = trips.find(trip => 
                    trip.status === 'EM_ANDAMENTO' && trip.driverName === currentUser.name
                );
                
                if (activeTrip) {
                    output += `
                        <div class="success">
                            üéØ <strong>VIAGEM EM ANDAMENTO DETECTADA!</strong><br>
                            O sistema automaticamente carregaria o formul√°rio de finaliza√ß√£o:<br><br>
                            <strong>Destino:</strong> ${activeTrip.cidade} - ${activeTrip.hospital}<br>
                            <strong>Sa√≠da:</strong> ${activeTrip.dataSaida} √†s ${activeTrip.horaSaida}<br>
                            <strong>KM Inicial:</strong> ${activeTrip.kmSaida}<br><br>
                            <em>Mensagem exibida:</em> "Viagem em andamento detectada! Complete os dados para finalizar."
                        </div>
                    `;
                } else {
                    output += '<div class="info">‚ÑπÔ∏è Nenhuma viagem em andamento encontrada. Formul√°rio de nova viagem seria exibido.</div>';
                }
            }

            document.getElementById('output').innerHTML = output;
        }

        // Mostrar dados ao carregar a p√°gina
        window.onload = function() {
            showTrips();
        };
    </script>
</body>
</html>
